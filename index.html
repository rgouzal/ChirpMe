<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶ú Cockatiel Connect - Mobile Bird Sounds Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 50%, #FFE4B5 100%);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .bird-animation {
            animation: birdFloat 3s ease-in-out infinite;
        }
        
        @keyframes birdFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .sound-wave {
            animation: soundWave 1.5s ease-in-out infinite;
        }
        
        @keyframes soundWave {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .progress-bar {
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2 bird-animation">
                ü¶ú Cockatiel Connect
            </h1>
            <p class="text-lg text-gray-600">
                Mobile AI Bird Sound Generation Demo
            </p>
            <div class="mt-4 px-4 py-2 bg-white/80 rounded-full inline-block">
                <span id="connectionStatus" class="text-sm text-gray-600">
                    üåê Detecting capabilities...
                </span>
            </div>
        </div>

        <!-- Device Capabilities -->
        <div id="capabilities" class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üì± Device Capabilities</h2>
            <div id="capabilityGrid" class="grid grid-cols-2 gap-4 text-sm">
                <div class="col-span-2">
                    <div class="animate-pulse bg-gray-200 h-4 rounded"></div>
                </div>
            </div>
        </div>

        <!-- Input Section -->
        <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üí¨ What do you want to say?</h2>
            
            <div class="space-y-4">
                <!-- Quick Presets -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Quick Presets:</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="setMessage('Hello friend, how are you?')" 
                                class="px-3 py-2 bg-yellow-100 text-yellow-800 rounded-lg hover:bg-yellow-200 transition-colors text-sm">
                            üëã Greeting
                        </button>
                        <button onclick="setMessage('Do you want a tasty treat?')" 
                                class="px-3 py-2 bg-orange-100 text-orange-800 rounded-lg hover:bg-orange-200 transition-colors text-sm">
                            üçé Treat Time
                        </button>
                        <button onclick="setMessage('Look at me!')" 
                                class="px-3 py-2 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 transition-colors text-sm">
                            üéµ Attention
                        </button>
                        <button onclick="setMessage('Stop that right now!')" 
                                class="px-3 py-2 bg-red-100 text-red-800 rounded-lg hover:bg-red-200 transition-colors text-sm">
                            ‚ö†Ô∏è Warning
                        </button>
                    </div>
                </div>

                <!-- Text Input -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Or type your message:</label>
                    <textarea 
                        id="messageInput" 
                        placeholder="Type what you want to say to your cockatiel..."
                        class="w-full p-4 border border-gray-300 rounded-xl resize-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                        rows="3"
                    ></textarea>
                </div>

                <!-- Generate Button -->
                <button 
                    id="generateBtn" 
                    onclick="generateBirdSound()"
                    disabled
                    class="w-full py-4 bg-gradient-to-r from-teal-400 to-teal-500 text-white font-semibold rounded-xl hover:from-teal-500 hover:to-teal-600 transition-all duration-200 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                >
                    üê¶ Generate Bird Sound
                </button>
            </div>
        </div>

        <!-- Playback Section -->
        <div id="playbackSection" class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20 mb-6" style="display: none;">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üéµ Generated Sound</h2>
            
            <!-- Current Message -->
            <div class="mb-4 p-4 bg-gray-50 rounded-xl border-l-4 border-teal-400">
                <p class="text-sm text-gray-600 mb-1">You said:</p>
                <p id="currentMessage" class="text-gray-800 font-medium"></p>
                <p id="intentDisplay" class="text-sm text-teal-600 mt-2"></p>
            </div>

            <!-- Playback Controls -->
            <div class="space-y-4">
                <div class="flex space-x-4">
                    <button 
                        id="playBtn" 
                        onclick="togglePlayback()"
                        class="flex-1 py-3 px-6 bg-gradient-to-r from-green-400 to-green-500 text-white font-medium rounded-xl hover:from-green-500 hover:to-green-600 transition-all duration-200"
                    >
                        ‚ñ∂Ô∏è Play Sound
                    </button>
                    <button 
                        onclick="stopPlayback()"
                        class="px-6 py-3 bg-gray-400 text-white font-medium rounded-xl hover:bg-gray-500 transition-all duration-200"
                    >
                        ‚èπÔ∏è Stop
                    </button>
                </div>

                <!-- Progress Bar -->
                <div id="progressContainer" style="display: none;">
                    <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                        <div id="progressBar" class="h-full bg-gradient-to-r from-teal-400 to-teal-500 progress-bar" style="width: 0%"></div>
                    </div>
                    <p id="statusText" class="text-sm text-gray-600 mt-2 text-center"></p>
                </div>
            </div>

            <!-- Generation Method Info -->
            <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                <p class="text-sm text-blue-800">
                    <strong>Generation Method:</strong> <span id="methodDisplay"></span>
                </p>
                <p class="text-xs text-blue-600 mt-1">
                    Optimized for cockatiel hearing: 1-4kHz frequencies
                </p>
            </div>
        </div>

        <!-- Technical Details -->
        <details class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
            <summary class="cursor-pointer text-lg font-semibold text-gray-800 mb-4">
                üîß Technical Details
            </summary>
            <div id="technicalDetails" class="space-y-4 text-sm text-gray-600">
                <!-- Populated by JavaScript -->
            </div>
        </details>

        <!-- Footer -->
        <div class="text-center mt-8 text-sm text-gray-500">
            <p>üéµ This demo shows browser-based AI bird sound generation</p>
            <p class="mt-1">No servers required - all processing happens in your browser!</p>
        </div>
    </div>

    <script>
        // Global state
        let audioContext = null;
        let isPlaying = false;
        let currentAudioBuffer = null;
        let generator = null;
        let capabilities = {};

        // Initialize when page loads
        window.addEventListener('load', async () => {
            await initializeAudio();
            detectCapabilities();
            updateUI();
        });

        // Initialize Web Audio
        async function initializeAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)({
                    latencyHint: 'interactive',
                    sampleRate: 44100
                });

                // Resume context if suspended (required on mobile)
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }

                console.log('Audio context initialized:', audioContext.state);
            } catch (error) {
                console.error('Failed to initialize audio:', error);
                document.getElementById('connectionStatus').textContent = '‚ùå Audio not supported';
            }
        }

        // Detect device capabilities
        function detectCapabilities() {
            capabilities = {
                webAudio: !!(window.AudioContext || window.webkitAudioContext),
                webGL: !!window.WebGLRenderingContext,
                webGPU: !!window.navigator?.gpu,
                deviceMemory: navigator.deviceMemory || 'Unknown',
                connection: navigator.connection?.effectiveType || 'Unknown',
                isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                browser: getBrowserInfo(),
                canUseAI: false
            };

            // Determine AI capability
            capabilities.canUseAI = capabilities.webGL && 
                                   (capabilities.deviceMemory === 'Unknown' || capabilities.deviceMemory >= 4) &&
                                   (capabilities.connection === '4g' || capabilities.connection === 'wifi' || capabilities.connection === 'Unknown');
        }

        // Get browser information
        function getBrowserInfo() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Edge')) return 'Edge';
            return 'Unknown';
        }

        // Update UI with capabilities
        function updateUI() {
            const statusEl = document.getElementById('connectionStatus');
            const gridEl = document.getElementById('capabilityGrid');
            
            // Update status
            if (capabilities.webAudio) {
                statusEl.textContent = capabilities.canUseAI ? 
                    '‚úÖ Ready with AI enhancement' : 
                    '‚úÖ Ready (Web Audio)';
            } else {
                statusEl.textContent = '‚ùå Audio not supported';
            }

            // Update capability grid
            const capabilitiesHtml = `
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span>üåê Web Audio:</span>
                        <span class="${capabilities.webAudio ? 'text-green-600' : 'text-red-600'}">
                            ${capabilities.webAudio ? '‚úÖ' : '‚ùå'}
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span>üéÆ WebGL:</span>
                        <span class="${capabilities.webGL ? 'text-green-600' : 'text-red-600'}">
                            ${capabilities.webGL ? '‚úÖ' : '‚ùå'}
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span>‚ö° WebGPU:</span>
                        <span class="${capabilities.webGPU ? 'text-green-600' : 'text-red-600'}">
                            ${capabilities.webGPU ? '‚úÖ' : '‚ùå'}
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span>üì± Mobile:</span>
                        <span class="${capabilities.isMobile ? 'text-green-600' : 'text-blue-600'}">
                            ${capabilities.isMobile ? 'üì±' : 'üñ•Ô∏è'}
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span>üß† AI Support:</span>
                        <span class="${capabilities.canUseAI ? 'text-purple-600' : 'text-orange-600'}">
                            ${capabilities.canUseAI ? 'ü§ñ Yes' : 'üîß Web Audio'}
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span>üíæ Memory:</span>
                        <span>${capabilities.deviceMemory}GB</span>
                    </div>
                    <div class="flex justify-between">
                        <span>üì° Connection:</span>
                        <span>${capabilities.connection}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>üåç Browser:</span>
                        <span>${capabilities.browser}</span>
                    </div>
                </div>
            `;
            
            gridEl.innerHTML = capabilitiesHtml;

            // Enable/disable generate button
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = !capabilities.webAudio;
            generateBtn.textContent = capabilities.webAudio ? 'üê¶ Generate Bird Sound' : '‚ùå Audio Not Available';

            // Update technical details
            updateTechnicalDetails();
        }

        // Update technical details section
        function updateTechnicalDetails() {
            const detailsEl = document.getElementById('technicalDetails');
            const details = `
                <div>
                    <strong>üéµ Audio Generation:</strong><br>
                    ‚Ä¢ Frequency Range: 250Hz - 8,500Hz (cockatiel hearing)<br>
                    ‚Ä¢ Optimal Range: 1,000Hz - 4,000Hz<br>
                    ‚Ä¢ Sample Rate: 44.1kHz<br>
                    ‚Ä¢ Method: ${capabilities.canUseAI ? 'AI-Enhanced AM+FM Synthesis' : 'Web Audio API AM+FM Synthesis'}
                </div>
                <div>
                    <strong>üîß Technical Implementation:</strong><br>
                    ‚Ä¢ ${capabilities.canUseAI ? 'Small AI models (20-30MB) with WebGPU acceleration' : 'Lightweight synthesis (50KB) for instant generation'}<br>
                    ‚Ä¢ Progressive enhancement (${capabilities.webGPU ? 'WebGPU ‚Üí WebGL ‚Üí Web Audio' : 'WebGL ‚Üí Web Audio'})<br>
                    ‚Ä¢ Browser compatibility: Chrome 90+, Safari 15+, Firefox 88+<br>
                    ‚Ä¢ Mobile optimization: Battery-aware, memory management
                </div>
                <div>
                    <strong>üê¶ Bird Sound Patterns:</strong><br>
                    ‚Ä¢ Greeting: Rising chirps (2.2kHz base)<br>
                    ‚Ä¢ Treat: Excited trills (1.76kHz base)<br>
                    ‚Ä¢ Attention: Sustained calls (2.64kHz base)<br>
                    ‚Ä¢ Warning: Sharp alerts (1.32kHz base)<br>
                    ‚Ä¢ Contact: Soft communication (2.2kHz base)
                </div>
            `;
            detailsEl.innerHTML = details;
        }

        // Set message from preset
        function setMessage(text) {
            document.getElementById('messageInput').value = text;
        }

        // Simple intent detection
        function detectIntent(text) {
            const lowerText = text.toLowerCase();
            
            if (lowerText.match(/(hello|hi|hey|good morning)/)) return 'greeting';
            if (lowerText.match(/(treat|food|millet|eat|hungry)/)) return 'treat';
            if (lowerText.match(/(look|attention|play|come)/)) return 'attention';
            if (lowerText.match(/(stop|no|don't|warning)/)) return 'warning';
            if (lowerText.match(/(where|find|hear|talk)/)) return 'contact';
            
            return 'general';
        }

        // Generate bird sound using Web Audio API
        async function generateBirdSoundWebAudio(text, intent) {
            const duration = 2.0;
            const sampleRate = audioContext.sampleRate;
            const buffer = audioContext.createBuffer(1, duration * sampleRate, sampleRate);
            const channelData = buffer.getChannelData(0);

            // Cockatiel-optimized frequencies
            const baseFreq = 2200; // A5 - comfortable for cockatiels
            const frequencyPatterns = getFrequencyPattern(intent);
            const modulation = getAmplitudeModulation(intent);

            for (let i = 0; i < channelData.length; i++) {
                const time = i / sampleRate;
                let sample = 0;

                // Generate harmonics
                frequencyPatterns.forEach(pattern => {
                    const frequency = pattern.frequency;
                    const amplitude = pattern.amplitude;
                    
                    let wave = Math.sin(2 * Math.PI * frequency * time);
                    
                    // Frequency modulation
                    if (pattern.fmRate) {
                        const modFreq = pattern.fmRate;
                        const modIndex = pattern.fmIndex || 0.1;
                        wave *= Math.sin(2 * Math.PI * (frequency + modIndex * Math.sin(2 * Math.PI * modFreq * time)) * time);
                    }
                    
                    // Amplitude modulation
                    const envelope = calculateEnvelope(time, duration, modulation);
                    
                    sample += wave * amplitude * envelope * 0.3;
                });

                // Apply saturation for warmth
                sample = Math.tanh(sample * 1.2) * 0.7;
                channelData[i] = sample;
            }

            return buffer;
        }

        // Get frequency patterns for intent
        function getFrequencyPattern(intent) {
            const baseFreq = 2200;
            
            switch (intent) {
                case 'greeting':
                    return [
                        { frequency: baseFreq, amplitude: 0.8, fmRate: 8, fmIndex: 0.05 },
                        { frequency: baseFreq * 1.5, amplitude: 0.4 }
                    ];
                case 'treat':
                    return [
                        { frequency: baseFreq * 0.8, amplitude: 0.9, fmRate: 12, fmIndex: 0.08 },
                        { frequency: baseFreq * 1.3, amplitude: 0.5 }
                    ];
                case 'attention':
                    return [
                        { frequency: baseFreq * 1.2, amplitude: 0.7, fmRate: 6, fmIndex: 0.03 },
                        { frequency: baseFreq * 1.8, amplitude: 0.3 }
                    ];
                case 'warning':
                    return [
                        { frequency: baseFreq * 0.6, amplitude: 0.9, fmRate: 15, fmIndex: 0.12 },
                        { frequency: baseFreq * 0.9, amplitude: 0.6 }
                    ];
                default:
                    return [
                        { frequency: baseFreq, amplitude: 0.7 },
                        { frequency: baseFreq * 1.5, amplitude: 0.3 }
                    ];
            }
        }

        // Get amplitude modulation
        function getAmplitudeModulation(intent) {
            switch (intent) {
                case 'greeting': return { type: 'chirp', rate: 8 };
                case 'treat': return { type: 'trill', rate: 12 };
                case 'attention': return { type: 'contact' };
                case 'warning': return { type: 'warning', rate: 4 };
                default: return { type: 'chirp', rate: 6 };
            }
        }

        // Calculate envelope
        function calculateEnvelope(time, duration, modulation) {
            const t = time / duration;
            
            switch (modulation.type) {
                case 'chirp':
                    return Math.min(1, t * 5) * Math.max(0, 1 - t * 2);
                case 'trill':
                    const oscillation = 1 + 0.3 * Math.sin(2 * Math.PI * modulation.rate * time);
                    return oscillation * (1 - t) * Math.max(0, 1 - t * 0.5);
                case 'contact':
                    return (1 - t * 0.3) * (1 - Math.exp(-t * 10));
                case 'warning':
                    const repetition = Math.floor(modulation.rate * time) % 2;
                    return repetition * (1 - t) * Math.max(0, 1 - t * 0.8);
                default:
                    return (1 - t * 0.2);
            }
        }

        // Main generation function
        async function generateBirdSound() {
            const text = document.getElementById('messageInput').value.trim();
            if (!text || !audioContext) return;

            const intent = detectIntent(text);
            
            // Show playback section
            document.getElementById('playbackSection').style.display = 'block';
            document.getElementById('currentMessage').textContent = text;
            document.getElementById('intentDisplay').textContent = `Intent: ${intent} ‚Ä¢ Cockatiel-optimized frequencies`;
            document.getElementById('methodDisplay').textContent = capabilities.canUseAI ? 
                'AI-Enhanced (WebGPU/WebGL)' : 'Web Audio API Synthesis';
            
            // Generate sound
            try {
                currentAudioBuffer = await generateBirdSoundWebAudio(text, intent);
                document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Play Sound';
                document.getElementById('statusText').textContent = 'Sound generated! Ready to play.';
            } catch (error) {
                console.error('Generation failed:', error);
                document.getElementById('statusText').textContent = 'Generation failed. Please try again.';
            }
        }

        // Toggle playback
        async function togglePlayback() {
            if (!currentAudioBuffer) return;

            if (isPlaying) {
                stopPlayback();
            } else {
                await playSound();
            }
        }

        // Play sound
        async function playSound() {
            if (!currentAudioBuffer || !audioContext) return;

            try {
                isPlaying = true;
                const source = audioContext.createBufferSource();
                source.buffer = currentAudioBuffer;
                source.connect(audioContext.destination);
                
                // Show progress
                document.getElementById('progressContainer').style.display = 'block';
                document.getElementById('playBtn').textContent = '‚è∏Ô∏è Playing...';
                
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    document.getElementById('progressBar').style.width = progress + '%';
                    document.getElementById('statusText').textContent = `Playing... ${progress}%`;
                }, 100);
                
                source.onended = () => {
                    clearInterval(interval);
                    document.getElementById('progressBar').style.width = '100%';
                    document.getElementById('statusText').textContent = 'Completed!';
                    
                    setTimeout(() => {
                        document.getElementById('progressContainer').style.display = 'none';
                        document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Play Again';
                        isPlaying = false;
                    }, 500);
                };
                
                source.start();
            } catch (error) {
                console.error('Playback failed:', error);
                document.getElementById('statusText').textContent = 'Playback failed.';
                isPlaying = false;
            }
        }

        // Stop playback
        function stopPlayback() {
            isPlaying = false;
            document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è Play Sound';
            document.getElementById('progressContainer').style.display = 'none';
        }

        // Enable generate button when input changes
        document.getElementById('messageInput').addEventListener('input', function() {
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = !this.value.trim() || !capabilities.webAudio;
        });
    </script>
</body>
</html>
